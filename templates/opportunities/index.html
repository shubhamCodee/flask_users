{% extends "base.html" %}

{% block content %}

    <div class="border-b border-darkgray pb-4 mb-8 flex justify-between items-center">
        <h1 class="text-3xl font-bold text-primary tracking-tight">Opportunities</h1>
        
        <a href="{{ url_for('opportunity.add_opportunity') }}" 
           class="bg-darkgray text-primary hover:bg-softgray hover:text-charcoal px-4 py-2 rounded transition-all duration-200 text-sm font-medium">
            + Add Deal
        </a>
    </div>

    <div class="bg-[#1E1E1E] border border-darkgray rounded-lg p-6 shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-secondary">Sales Pipeline</h2>
        
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="text-secondary text-sm border-b border-darkgray">
                        <th class="py-3 font-medium uppercase tracking-wider">Deal Name</th>
                        <th class="py-3 font-medium uppercase tracking-wider">Stage</th>
                        <th class="py-3 font-medium uppercase tracking-wider">Value</th>
                        <th class="py-3 font-medium uppercase tracking-wider">Probability</th>
                        <th class="py-3 font-medium uppercase tracking-wider">Assigned To</th>
                        <th class="py-3 font-medium uppercase tracking-wider text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="text-primary">
                    {% for opp in opportunities %}
                        <tr class="border-b border-darkgray last:border-0 hover:bg-[#2a2a2a] transition-colors">
                            <td class="py-4 font-bold">{{ opp.name }}</td>
                            <td class="py-4">
                                <span class="text-xs font-bold uppercase tracking-wide 
                                    {% if opp.sales_stage == 'Closed Won' %} text-green-400 
                                    {% elif opp.sales_stage == 'Closed Lost' %} text-red-400 
                                    {% else %} text-yellow-400 {% endif %}">
                                    {{ opp.sales_stage or 'New' }}
                                </span>
                            </td>
                            <td class="py-4 font-mono text-softgray">${{ opp.amount }}</td>
                            <td class="py-4 text-sm text-secondary">{{ opp.probability }}%</td>
                            <td class="py-4 text-sm">
                                {% if opp.assigned_user %}
                                    <span class="bg-blue-900/30 text-blue-200 px-2 py-1 rounded text-xs">
                                        {{ opp.assigned_user.username }}
                                    </span>
                                {% else %}
                                    <span class="text-darkgray italic">Unassigned</span>
                                {% endif %}
                            </td>
                            <td class="py-4 text-right gap-3">
                                <a href="{{ url_for('opportunity.update_opportunity', id=opp.id) }}" 
                                   class="text-softgray hover:text-primary text-sm mr-3">Edit</a>
                                <a href="{{ url_for('opportunity.delete_opportunity', id=opp.id) }}" 
                                   class="text-red-400/70 hover:text-red-400 text-sm">Delete</a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="py-8 text-center text-secondary">
                                No deals yet. Go close some!
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}