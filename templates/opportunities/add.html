{% extends "base.html" %}

{% block content %}

    <!-- Header & Navigation -->
    <div class="border-b border-darkgray pb-4 mb-8 flex justify-between items-end">
        <div>
            <div class="flex items-center gap-2 text-sm text-secondary mb-2">
                <a href="{{ url_for('opportunity.index') }}" class="hover:text-primary transition-colors">Pipeline</a>
                <span class="text-darkgray">/</span>
                <span class="text-softgray">New Deal</span>
            </div>
            <h1 class="text-3xl font-bold text-primary tracking-tight">Create Opportunity</h1>
        </div>
    </div>

    <!-- MAIN FORM -->
    <form action="{{ url_for('opportunity.add_opportunity') }}" autocomplete="off" method="POST">
        
        <div class="bg-[#1E1E1E] border border-darkgray rounded-lg shadow-xl max-w-6xl mx-auto overflow-hidden">
            
            <!-- SECTION 1: DEAL BASICS -->
            <div class="p-8 border-b border-darkgray">
                <h2 class="text-xs font-bold uppercase tracking-widest text-softgray mb-6">1. Deal Overview</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="md:col-span-2">
                        <label class="block text-xs text-secondary mb-1">Opportunity Name *</label>
                        <input type="text" name="name" required class="form-input" placeholder="e.g. HDFC Core Banking API Upgrade">
                    </div>
                    
                    <div>
                        <label class="block text-xs text-secondary mb-1">Sales Stage *</label>
                        <select name="sales_stage" class="form-input">
                            <option value="Prospecting">Prospecting</option>
                            <option value="Qualification">Qualification</option>
                            <option value="Value Proposition">Value Proposition</option>
                            <option value="Proposal">Proposal</option>
                            <option value="Negotiation">Negotiation</option>
                            <option value="Closed Won">Closed Won</option>
                            <option value="Closed Lost">Closed Lost</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-xs text-secondary mb-1">Assigned Owner</label>
                        <select name="assigned_user_id" class="form-input">
                            <option value="">-- Select User --</option>
                            {% for user in users %}
                                <option value="{{ user.id }}">{{ user.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: COMMERCIALS & TIMELINE -->
            <div class="p-8 border-b border-darkgray bg-[#1a1a1a]">
                <h2 class="text-xs font-bold uppercase tracking-widest text-softgray mb-6">2. Commercials & Timeline</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    
                    <!-- Money Row -->
                    <div>
                        <label class="block text-xs text-secondary mb-1">Amount (₹)</label>
                        <input type="number" step="0.01" name="amount" class="form-input" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Gross Profit (₹)</label>
                        <input type="number" step="0.01" name="gross_profit" class="form-input" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Quantity</label>
                        <input type="number" step="0.01" name="quantity" class="form-input" value="1">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Probability (%)</label>
                        <input type="number" step="0.01" name="probability" class="form-input" placeholder="0-100">
                    </div>

                    <!-- Dates Row -->
                    <div class="col-span-2">
                        <label class="block text-xs text-secondary mb-1">Expected Close Date</label>
                        <input type="date" name="expected_closed_date" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Actual Close Date</label>
                        <input type="date" name="closed_date" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Priority</label>
                        <select name="priority" class="form-input">
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Critical">Critical</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: CLASSIFICATION -->
            <div class="p-8 border-b border-darkgray">
                <h2 class="text-xs font-bold uppercase tracking-widest text-softgray mb-6">3. Classification</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-xs text-secondary mb-1">Opportunity Type</label>
                        <input type="text" name="opportunity_type" class="form-input" placeholder="New Business / Existing">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Customer Type</label>
                        <input type="text" name="customer_type" class="form-input" placeholder="e.g. Enterprise">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Lead Source</label>
                        <input type="text" name="lead_source" class="form-input" placeholder="e.g. Referral">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Product Category</label>
                        <input type="text" name="product_sub_category" class="form-input" placeholder="e.g. Software License">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs text-secondary mb-1">Lost Reason (If Closed Lost)</label>
                        <input type="text" name="lost_reason" class="form-input" placeholder="e.g. Price too high">
                    </div>
                </div>
            </div>

            <!-- SECTION 4: SYSTEM & FOLLOW UP -->
            <div class="p-8 border-b border-darkgray bg-[#1a1a1a]">
                <h2 class="text-xs font-bold uppercase tracking-widest text-softgray mb-6">4. Tracking & Settings</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label class="block text-xs text-secondary mb-1">Next Follow-up</label>
                        <input type="datetime-local" name="next_followup_date" class="form-input">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Follow-up Type</label>
                        <select name="next_followup_type" class="form-input">
                            <option value="">-- Select --</option>
                            <option value="Call">Call</option>
                            <option value="Email">Email</option>
                            <option value="Meeting">Meeting</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">How Old (Days)</label>
                        <input type="number" name="how_old_days" class="form-input" value="0">
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Untouched (Days)</label>
                        <input type="number" name="untouched_since_days" class="form-input" value="0">
                    </div>
                </div>

                <!-- Advanced Booleans -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-2 border-t border-darkgray/50">
                    <label class="flex items-center gap-2 cursor-pointer p-2 hover:bg-[#2a2a2a] rounded">
                        <input type="checkbox" name="contract_automation" value="true" class="accent-primary">
                        <span class="text-xs text-secondary">Contract Automation</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-2 hover:bg-[#2a2a2a] rounded">
                        <input type="checkbox" name="current_opportunity" value="true" class="accent-primary" checked>
                        <span class="text-xs text-secondary">Current Opportunity</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-2 hover:bg-[#2a2a2a] rounded">
                        <input type="checkbox" name="contract_created" value="true" class="accent-primary">
                        <span class="text-xs text-secondary">Contract Created</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer p-2 hover:bg-[#2a2a2a] rounded">
                        <input type="checkbox" name="auto_product_created" value="true" class="accent-primary">
                        <span class="text-xs text-secondary">Auto Product Created</span>
                    </label>
                </div>

                <!-- System IDs (Collapsed/Optional) -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-darkgray/50 opacity-60 hover:opacity-100 transition-opacity">
                    <div>
                        <label class="block text-[10px] text-darkgray mb-1">Team ID</label>
                        <input type="text" name="team_id" class="form-input-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-darkgray mb-1">Team Set ID</label>
                        <input type="text" name="team_set_id" class="form-input-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-darkgray mb-1">Last Contract ID</label>
                        <input type="text" name="last_contract_id" class="form-input-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] text-darkgray mb-1">Lead Created Date</label>
                        <input type="datetime-local" name="lead_created_date" class="form-input-sm">
                    </div>
                </div>
            </div>

            <!-- SECTION 5: NOTES -->
            <div class="p-8">
                <h2 class="text-xs font-bold uppercase tracking-widest text-softgray mb-6">5. Remarks</h2>
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label class="block text-xs text-secondary mb-1">Description / Scope</label>
                        <textarea name="description" rows="3" class="form-textarea"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs text-secondary mb-1">Latest Comment</label>
                        <textarea name="latest_comment" rows="3" class="form-textarea"></textarea>
                    </div>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="p-8 border-t border-darkgray flex justify-end gap-4 bg-charcoal">
                <a href="{{ url_for('opportunity.index') }}" class="px-6 py-3 border border-darkgray text-secondary rounded hover:text-primary transition-colors">Cancel</a>
                <button type="submit" class="bg-primary text-charcoal font-bold px-8 py-3 rounded hover:bg-white transition-all shadow-lg">
                    Create Deal
                </button>
            </div>

        </div>
    </form>

    <!-- STYLES -->
    <style>
        .form-input {
            width: 100%;
            background-color: #121212;
            border: 1px solid #444444;
            color: #E0E0E0;
            padding: 0.75rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }
        .form-input:focus { outline: none; border-color: #888888; }
        
        .form-input-sm {
            width: 100%;
            background-color: #121212;
            border: 1px solid #333333;
            color: #B0B0B0;
            padding: 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        .form-input-sm:focus { outline: none; border-color: #666666; }

        .form-textarea {
            width: 100%;
            background-color: #121212;
            border: 1px solid #444444;
            color: #E0E0E0;
            padding: 0.75rem;
            border-radius: 0.25rem;
        }
        .form-textarea:focus { outline: none; border-color: #888888; }
    </style>

{% endblock %}